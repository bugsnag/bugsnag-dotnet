image: Visual Studio 2022
install:
  - set PATH=C:\Ruby27-x64\bin;%PATH%
  - bundle install 
build_script:
  - ps: .\build.ps1 --target Appveyor
after_build:
  - ps: 7z a build\bugsnag.zip build\Release\**\Bugsnag*.dll build\Release\**\Bugsnag*.pdb
test: off
artifacts:
  - path: 'build\packages\*.*nupkg'
  - path: 'build\bugsnag.zip'
deploy:
  - provider: NuGet
    api_key:
      secure: gu4bITgZPQqhN9yT/sizv6AHBkdiANBvEbyGkMeRMWfVXQnUO1kk1Ib6x/snIrrE 
    skip_symbols: false
    symbol_server: https://www.nuget.org/api/v2/symbolpackage
    artifact: /.*(\.|\.s)nupkg/
    on:
      appveyor_repo_tag: true
  - provider: GitHub
    description: draft release
    auth_token:
      secure: 1HE8bikN3sntks6sONzT0nVoW5FZ7lQRAwMpgZkGNcpLM2t9Em9x7MCfwyhcierN
    artifact: build\bugsnag.zip
    draft: true
    on:
      appveyor_repo_tag: true
